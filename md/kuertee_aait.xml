<?xml version="1.0" encoding="utf-8"?>
<mdscript name="kuertee_aait" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<cue name="kAAIT2" namespace="this" version="7">
			<actions>
				<set_value name="global.$kAAIT" exact="this" />
			</actions>
			<patch sinceversion="2">
				<debug_text text="'patch sinceversion, state: ' + this.state" />
				<set_value name="global.$SuppressCommChatter" exact="false" />
			</patch>
			<cues>
				<cue name="OnModLuaInited">
					<conditions>
						<event_ui_triggered screen="'uix_mod_lua'" control="'init'" />
					</conditions>
					<actions>
						<debug_text text="event.name + ' param: ' + @event.param + ' param2: ' + @event.param2" />
						<raise_lua_event name="'Interact_Menu_API.Add_Custom_Actions_Group_Id'" param="'kuda_interact_menu'" />
						<raise_lua_event name="'Interact_Menu_API.Add_Custom_Actions_Group_Text'" param="{1111920, 17}" />
						<set_value name="$IsUIXExists" exact="true" />
						<reset_cue cue="this" />
					</actions>
				</cue>
				<cue name="kAAIT2_Config" namespace="this" version="24">
					<actions>
						<set_value name="global.$kAAIT_Data" exact="this" />
						<set_value name="global.$kAAIT_Data.$debugChance" exact="0" />
						<!-- configs: -->
						<!-- kAAIT_ApplyCustomBehaviourOrNot, kAAIT_MoveAroundOrNot -->
						<set_value name="global.$kAAIT_Data.$xssm_isAvoidHighRisk" exact="true" />
						<set_value name="global.$kAAIT_Data.$xssm_isAvoidHighRisk_allFactions" exact="false" />
						<!-- kAAIT_MoveAroundOrNot -->
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation_allFactions" exact="false" />
						<!-- kAAIT_LXL_StepForwardOrMoveOutOfRange -->
						<set_value name="global.$kAAIT_Data.$lxl_moveToEngagePosition_vShip" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isStepForward_vShip" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isStepForward_vShip_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isStepForward_vStation" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isStepForward_vStation_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation" exact="true" />
						<set_value name="global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation_allFactions" exact="false" />
						<!-- xs, s, and m -->
						<set_value name="global.$kAAIT_Data.$xss_outnumberVShips" exact="25" />
						<set_value name="global.$kAAIT_Data.$xss_outnumberVStations" exact="75" />
						<set_value name="global.$kAAIT_Data.$m_outnumberVShips" exact="50" />
						<set_value name="global.$kAAIT_Data.$m_outnumberVStations" exact="75" />
						<!-- other options -->
						<set_value name="global.$kAAIT_Data.$isUseNPCSkills" exact="true" />
						<set_value name="global.$kAAIT_Data.$isCarriersAttackLikeDestroyers" exact="false" />
						<set_value name="global.$kAAIT_Data.$isCarriersAttackLikeDestroyers_allFactions" exact="false" />
						<!-- individual ship settings -->
						<create_group groupname="global.$kAAIT_Data.$ships" />
						<set_value name="global.$kAAIT_Data.$byShipId" exact="table[]" />
						<set_value name="global.$kAAITByShipId" exact="global.$kAAIT_Data.$byShipId" comment="shortcut to $byShipId" />
						<!-- commander defaulr order data
						in the base game, the replacement commander doesn't acquire the previous commander's default order. this leaves all subordinates to be dumb - sometimes only responding to threads after they've attacked. -->
						<set_value name="global.$kAAIT_Data.$defaultOrdersByShipId" exact="table[]" />
						<set_value name="global.$kAAIT_Data.$lxl_isStrictMaintainDistance" exact="table[]" />
						<!-- optimisation settings -->
						<set_value name="global.$kAAIT_Data.$optimisation_hit_event" exact="1" />
						<set_value name="global.$kAAIT_Data.$optimisation_radar_event" exact="1" />
					</actions>
					<patch sinceversion="5">
						<debug_text text="'sinceversion 5, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$lxl_isStepForward_vShip" exact="global.$kAAIT_Config.$lxl_isStepForward" />
						<set_value name="global.$kAAIT_Config.$lxl_isStepForward_vShip_allFactions" exact="global.$kAAIT_Config.$lxl_isStepForward_allFactions" />
						<set_value name="global.$kAAIT_Config.$lxl_isMoveOutOfRange_vShip" exact="global.$kAAIT_Config.$lxl_isMoveOutOfRange" />
						<set_value name="global.$kAAIT_Config.$lxl_isMoveOutOfRange_vShip_allFactions" exact="global.$kAAIT_Config.$lxl_isMoveOutOfRange_allFactions" />
						<set_value name="global.$kAAIT_Config.$lxl_isStepForward_vStation" exact="true" />
						<set_value name="global.$kAAIT_Config.$lxl_isStepForward_vStation_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Config.$lxl_isMoveOutOfRange_vStation" exact="true" />
						<set_value name="global.$kAAIT_Config.$lxl_isMoveOutOfRange_vStation_allFactions" exact="false" />
					</patch>
					<patch sinceversion="6">
						<debug_text text="'sinceversion 6, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip" exact="global.$kAAIT_Config.$lxl_isAvoidHighRisk" />
						<set_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip_allFactions" exact="global.$kAAIT_Config.$lxl_isAvoidHighRisk_allFactions" />
						<set_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation" exact="global.$kAAIT_Config.$lxl_isAvoidHighRisk" />
						<set_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation_allFactions" exact="global.$kAAIT_Config.$lxl_isAvoidHighRisk_allFactions" />
						<set_value name="global.$kAAIT_Config.$xss_outnumberVShips" exact="25" />
						<set_value name="global.$kAAIT_Config.$xss_outnumberVStations" exact="75" />
						<set_value name="global.$kAAIT_Config.$m_outnumberVShips" exact="50" />
						<set_value name="global.$kAAIT_Config.$m_outnumberVStations" exact="75" />
						<remove_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk" />
						<remove_value name="global.$kAAIT_Config.$lxl_isAvoidHighRisk_allFactions" />
						<remove_value name="global.$kAAIT_Config.$xssm_outnumberVShips" />
						<remove_value name="global.$kAAIT_Config.$xssm_outnumberVStations" />
					</patch>
					<patch sinceversion="7">
						<debug_text text="'sinceversion 7, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$lxl_moveToEngagePosition_vShip" exact="false" />
					</patch>
					<patch sinceversion="8">
						<debug_text text="'sinceversion 8, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$lxl_moveToEngagePosition_vShip" exact="true" />
					</patch>
					<patch sinceversion="9">
						<debug_text text="'sinceversion 9, state: ' + this.state" />
						<remove_value name="$optimalRangeIsMax" />
					</patch>
					<patch sinceversion="10">
						<debug_text text="'sinceversion 10, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$isUseNPCSkills" exact="true" />
					</patch>
					<patch sinceversion="11">
						<debug_text text="'sinceversion 11, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$lxl_isStepForward_vShip" exact="false" />
					</patch>
					<patch sinceversion="12">
						<debug_text text="'sinceversion 12, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$isCarriersAttackLikeDestroyers" exact="false" />
						<set_value name="global.$kAAIT_Config.$isCarriersAttackLikeDestroyers_allFactions" exact="false" />
					</patch>
					<patch sinceversion="14">
						<debug_text text="'sinceversion 14, state: ' + this.state" />
						<set_value name="global.$kAAIT_Config.$settingsByShipId" exact="table[]" />
					</patch>
					<patch sinceversion="16">
						<debug_text text="'sinceversion 16, state: ' + this.state" />
						<set_value name="global.$kAAIT_Data" exact="this" />
						<remove_value name="global.$kAAIT_Config" />
					</patch>
					<patch sinceversion="17">
						<debug_text text="'sinceversion 17, state: ' + this.state" />
						<set_value name="global.$kAAITByShipId" exact="global.$kAAIT_Data.$settingsByShipId" />
					</patch>
					<patch sinceversion="19">
						<debug_text text="'sinceversion 19, state: ' + this.state" />
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip_allFactions" exact="false" />
						<set_value name="global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation_allFactions" exact="false" />
					</patch>
					<patch sinceversion="20">
						<debug_text text="'patch sinceversion 20, state: ' + this.state" />
						<create_group groupname="global.$kAAIT_Data.$ships" />
						<do_for_each name="$ship_inList" in="kAAIT_SettingsByShip.$ships">
							<add_to_group groupname="global.$kAAIT_Data.$ships" object="$ship_inList" />
						</do_for_each>
						<remove_value name="kAAIT_SettingsByShip.$ships" />
						<run_actions ref="DebugData">
							<param name="Data" value="global.$kAAIT_Data.$ships" />
							<param name="Prefix" value="'patch 20: global.$kAAIT_Data.$ships'" />
						</run_actions>
						<run_actions ref="DebugData">
							<param name="Data" value="@kAAIT_SettingsByShip.$ships" />
							<param name="Prefix" value="'patch 20: should be empty: kAAIT_SettingsByShip.$ships'" />
						</run_actions>
						<set_value name="global.$kAAIT_Data.$byShipId" exact="table[]" />
						<do_for_each name="$idCode_inList" valuename="$data_inList" in="global.$kAAIT_Data.$settingsByShipId">
							<set_value name="global.$kAAIT_Data.$byShipId.{$idCode_inList}" exact="$data_inList" />
						</do_for_each>
						<remove_value name="global.$kAAIT_Data.$settingsByShipId" />
						<run_actions ref="DebugData">
							<param name="Data" value="global.$kAAIT_Data.$byShipId" />
							<param name="Prefix" value="'patch 20: global.$kAAIT_Data.$byShipId'" />
						</run_actions>
						<run_actions ref="DebugData">
							<param name="Data" value="@global.$kAAIT_Data.$settingsByShipId" />
							<param name="Prefix" value="'patch 20: should be empty: global.$kAAIT_Data.$settingsByShipId'" />
						</run_actions>
					</patch>
					<patch sinceversion="21">
						<debug_text text="'patch sinceversion 21, state: ' + this.state" />
						<set_value name="global.$kAAIT_Data.$byShipId" exact="table[]" />
						<do_for_each name="$idCode_inList" valuename="$data_inList" in="global.$kAAITByShipId">
							<set_value name="global.$kAAITByShipId.{$idCode_inList}" exact="$data_inList" />
						</do_for_each>
						<set_value name="global.$kAAITByShipId" exact="global.$kAAIT_Data.$byShipId" comment="shortcut to $byShipId" />
						<run_actions ref="DebugData">
							<param name="Data" value="global.$kAAIT_Data.$byShipId" />
							<param name="Prefix" value="'patch 21: global.$kAAIT_Data.$byShipId'" />
						</run_actions>
						<run_actions ref="DebugData">
							<param name="Data" value="global.$kAAITByShipId" />
							<param name="Prefix" value="'patch 21: should be the same: global.$kAAITByShipId'" />
						</run_actions>
					</patch>
					<patch sinceversion="22">
						<debug_text text="'patch sinceversion 22, state: ' + this.state" />
						<set_value name="global.$kAAIT_Data.$defaultOrdersByShipId" exact="table[]" />
					</patch>
					<patch sinceversion="24">
						<debug_text text="'patch sinceversion 24, state: ' + this.state" />
						<set_value name="global.$kAAIT_Data.$optimisation_hit_event" exact="1" />
						<set_value name="global.$kAAIT_Data.$optimisation_radar_event" exact="1" />
					</patch>
				</cue>
			</cues>
		</cue>
		<!--
			.dP"Y8 88  88 88 88""Yb     8888b.     db    888888    db
			`Ybo." 88  88 88 88__dP      8I  Yb   dPYb     88     dPYb
			o.`Y8b 888888 88 88"""       8I  dY  dP__Yb    88    dP__Yb
			8bodP' 88  88 88 88         8888Y"  dP""""Yb   88   dP""""Yb
		 -->
		<cue name="kAAIT_SettingsByShip" namespace="this" version="3">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
			</actions>
			<patch sinceversion="2">
				<debug_text text="'patch sinceversion 2, state: ' + this.state" />
				<set_value name="$ids" exact="[]" />
				<do_for_each name="$ship_inList" in="global.$kAAIT_Data.$ships" reverse="true">
					<do_if value="not @global.$kAAIT_Data.$byShipId.{'$' + $ship_inList.idcode}">
						<remove_from_group group="global.$kAAIT_Data.$ships" object="$ship_inList" />
						<debug_text text="'remove_from_group: ' + $ship_inList.idcode" />
					</do_if>
					<do_else>
						<append_to_list name="$ids" exact="'$' + $ship_inList.idcode" />
						<debug_text text="'keep: ' + $ship_inList.idcode + ': ' + global.$kAAIT_Data.$byShipId.{'$' + $ship_inList.idcode}" />
					</do_else>
				</do_for_each>
				<do_for_each name="$id_inList" valuename="$value_inList" in="global.$kAAIT_Data.$byShipId" reverse="true">
					<do_if value="not $ids.indexof.{$id_inList}">
						<remove_value name="global.$kAAIT_Data.$byShipId.{$id_inList}.$kAAIT_Data" />
						<do_if value="not global.$kAAIT_Data.$byShipId.{$id_inList}.keys.count">
							<remove_value name="global.$kAAIT_Data.$byShipId.{$id_inList}" />
							<debug_text text="'remove_value: ' + $id_inList + ': ' + global.$kAAIT_Data.$byShipId.{$id_inList}" />
						</do_if>
						<do_else>
							<debug_text text="'keep: ' + $id_inList + ': ' + global.$kAAIT_Data.$byShipId.{$id_inList}" />
						</do_else>
					</do_if>
				</do_for_each>
				<remove_value name="$ids" />
			</patch>
			<patch sinceversion="3">
				<debug_text text="'patch sinceversion 3, state: ' + this.state" />
				<do_for_each name="$id_inList" valuename="$value_inList" in="global.$kAAIT_Data.$byShipId" reverse="true">
					<set_value name="global.$kAAIT_Data.$byShipId.{$id_inList}.$attackData" exact="@global.$kAAIT_Data.$byShipId.{$id_inList}.$kAAIT_data" />
					<remove_value name="global.$kAAIT_Data.$byShipId.{$id_inList}.$kAAIT_data" />
					<debug_text text="$id_inList + ': ' + global.$kAAIT_Data.$byShipId.{$id_inList}.$attackData" />
					<debug_text text="$id_inList + ': ' + @global.$kAAIT_Data.$byShipId.{$id_inList}.$kAAIT_data" />
				</do_for_each>
			</patch>
			<cues>
				<cue name="ShipStoppedCombat" instantiate="true" namespace="this">
					<conditions>
						<check_any>
							<event_object_destroyed group="global.$kAAIT_Data.$ships" />
							<!-- <event_object_docked group="global.$kAAIT_Data.$ships" />
							<event_object_undocked group="global.$kAAIT_Data.$ships" /> -->
							<event_object_changed_sector group="global.$kAAIT_Data.$ships" />
						</check_any>
					</conditions>
					<actions>
						<debug_text text="'event.object: ' + @event.object.idcode + ' event.name: ' + event.name" chance="if @event.object.idcode == @global.$kAAIT.$debugChance_idCode or @global.$kAAIT.$debugChance_idCode == 'all' then @global.$kAAIT_Data.$debugChance else 0" />
						<debug_text text="'global.$kAAIT_Data.$byShipId.{$' + event.object.idcode + '} (pre): ' + @global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}" chance="if @event.object.idcode == @global.$kAAIT.$debugChance_idCode or @global.$kAAIT.$debugChance_idCode == 'all' then @global.$kAAIT_Data.$debugChance else 0" />
						<do_if value="@global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}">
							<do_if value="
								event.name != 'event_object_destroyed' and
								(
									global.$kAAITByShipId.{'$' + event.object.idcode}.$kAAIT_isAllowOtherTargets_user? or
									global.$kAAITByShipId.{'$' + event.object.idcode}.$kAAIT_isAvoidHighRisk_user? or
									global.$kAAITByShipId.{'$' + event.object.idcode}.$kAAIT_isStepForwardWithdraw_user?
								)
							">
								<do_for_each name="$key" in="global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}.keys.list">
									<do_if value="
										not [
											'$kAAIT_isAllowOtherTargets_user',
											'$kAAIT_isAvoidHighRisk_user',
											'$kAAIT_isStepForwardWithdraw_user',
											'$ship'
										].indexof.{$key}">
										<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}.{$key}" />
									</do_if>
								</do_for_each>
								<do_if value="
									(not global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}.keys.count) or
									(
										global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}.keys.count == 1 and
										global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}.$ship?
									)
								">
									<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}" />
								</do_if>
							</do_if>
							<do_else>
								<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}" />
							</do_else>
							<!-- <do_elseif value="not @event.object.order.$kAAITParam_iskAAITOrder" comment="kuda orders will clean themselves up after they complete">
								<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}" />
							</do_elseif> -->
						</do_if>
						<do_if value="not global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}?">
							<remove_from_group group="global.$kAAIT_Data.$ships" object="event.object" />
						</do_if>
						<debug_text text="'event.object.order.$kAAITParam_iskAAITOrder (post): ' + @event.object.order.$kAAITParam_iskAAITOrder" chance="if @event.object.idcode == @global.$kAAIT.$debugChance_idCode or @global.$kAAIT.$debugChance_idCode == 'all' then @global.$kAAIT_Data.$debugChance else 0" />
						<debug_text text="'global.$kAAIT_Data.$byShipId.{$' + event.object.idcode + '} (post): ' + @global.$kAAIT_Data.$byShipId.{'$' + event.object.idcode}" chance="if @event.object.idcode == @global.$kAAIT.$debugChance_idCode or @global.$kAAIT.$debugChance_idCode == 'all' then @global.$kAAIT_Data.$debugChance else 0" />
					</actions>
				</cue>
				<cue name="kAAIT_SettingsByShip_CleanUpOnReload">
					<conditions>
						<check_any>
							<event_cue_signalled />
							<event_game_loaded />
							<!-- <event_ui_triggered screen="'OptionsMenu'" /> -->
						</check_any>
					</conditions>
					<actions>
						<do_if value="event.name == 'event_game_loaded'">
							<set_value name="global.$kAAIT_Data.$debugChance" exact="100" />
						</do_if>
						<do_if value="global.$kAAIT.$debugChance_idCode?">
							<remove_value name="global.$kAAIT.$debugChance_idCode" />
						</do_if>
						<debug_text text="event.name" chance="@global.$kAAIT_Data.$debugChance" />
						<debug_text text="'global.$kAAIT_Data.$byShipId.keys.count (pre): ' + global.$kAAIT_Data.$byShipId.keys.count" chance="@global.$kAAIT_Data.$debugChance" />
						<do_for_each name="$idCode_inList" valuename="$data_inList" in="global.$kAAIT_Data.$byShipId" reverse="true">
							<run_actions ref="CleanUp_OneShip">
								<param name="IdCode" value="$idCode_inList" />
								<param name="Ship" value="$data_inList.$ship" />
							</run_actions>
						</do_for_each>
						<debug_text text="'global.$kAAIT_Data.$ships.count (post data clean-up): ' + global.$kAAIT_Data.$ships.count" chance="@global.$kAAIT_Data.$debugChance" />
						<debug_text text="'global.$kAAIT_Data.$byShipId.keys.count (post): ' + global.$kAAIT_Data.$byShipId.keys.count" chance="@global.$kAAIT_Data.$debugChance" />
						<run_actions ref="DebugData" chance="@global.$kAAIT_Data.$debugChance">
							<param name="Data" value="global.$kAAIT_Data.$byShipId" />
							<param name="Prefix" value="'kAAIT_SettingsByShip_CleanUpOnReload global.$kAAIT_Data.$byShipId'" />
						</run_actions>
						<do_if value="event.name == 'event_game_loaded'">
							<set_value name="global.$kAAIT_Data.$debugChance" exact="0" />
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>
				<library name="CleanUp_OneShip" purpose="run_actions">
					<params>
						<param name="IdCode" />
						<param name="Ship" />
					</params>
					<actions>
						<set_value name="$ShipData" exact="@global.$kAAIT_Data.$byShipId.{'$' + $IdCode}" />
						<debug_text text="$IdCode + ': ' + $Ship + ' $ShipData: ' + $ShipData" chance="@global.$kAAIT_Data.$debugChance" />
						<do_if value="not $ShipData">
							<debug_text text="$IdCode + ' has no data. removing.'" chance="@global.$kAAIT_Data.$debugChance" />
							<do_if value="$Ship.exists">
								<remove_from_group group="global.$kAAIT_Data.$ships" object="$Ship" />
							</do_if>
						</do_if>
						<do_else>
							<set_value name="$isCleanThisShip" exact="true" />
							<do_if value="@$ShipData.$ship.isclass.ship">
								<do_for_each name="$order" in="$ShipData.$ship.orders">
									<do_if value="$order.id == 'Attack' or $order.id == 'TacticalOrder' or @$order.$kAAITParam_iskAAITOrder">
										<set_value name="$isCleanThisShip" exact="false" />
										<break />
									</do_if>
								</do_for_each>
							</do_if>
							<debug_text text="$IdCode + ' $isCleanThisShip: ' + $isCleanThisShip + ' $ShipData.keys.list: ' + $ShipData.keys.list" chance="@global.$kAAIT_Data.$debugChance" />
							<do_if value="$isCleanThisShip">
								<do_for_each name="$key" in="$ShipData.keys.list">
									<do_if value="
										not [
											'$kAAIT_isAllowOtherTargets_user',
											'$kAAIT_isAvoidHighRisk_user',
											'$kAAIT_isStepForwardWithdraw_user',
											'$ship'
										].indexof.{$key}">
										<remove_value name="$ShipData.{$key}" />
									</do_if>
								</do_for_each>
								<do_if value="
									@global.$kAAIT_Data.$ships.indexof.{$ShipData.$ship} or
									(
										global.$kAAIT_Data.$byShipId.{$IdCode}? and
										(
											(not global.$kAAIT_Data.$byShipId.{$IdCode}.keys.count) or
											(
												global.$kAAIT_Data.$byShipId.{$IdCode}.keys.count == 1 and
												global.$kAAIT_Data.$byShipId.{$IdCode}.$ship?
											)
										)
									)" comment="not registered or doesn't have a player setting (e.g. is allow avoid), remove this data">
									<do_if value="@global.$kAAIT_Data.$ships.indexof.{$ShipData.$ship}">
										<remove_from_group group="global.$kAAIT_Data.$ships" object="$ShipData.$ship" />
									</do_if>
									<do_if value="global.$kAAIT_Data.$byShipId.{$IdCode}?">
										<remove_value name="global.$kAAIT_Data.$byShipId.{$IdCode}" />
									</do_if>
									<debug_text text="$IdCode + ' removing ship from list.'" chance="@global.$kAAIT_Data.$debugChance" />
								</do_if>
							</do_if>
						</do_else>
					</actions>
				</library>
				<cue name="kAAIT_SettingsByShip_CleanUpOnReload_RunOnce">
					<actions>
						<signal_cue cue="kAAIT_SettingsByShip_CleanUpOnReload" />
					</actions>
				</cue>
			</cues>
		</cue>
		<cue name="kAAIT_SettingsByShip_RunOnce">
			<actions>
				<do_if value="kAAIT_SettingsByShip.state == cuestate.waiting">
					<signal_cue cue="kAAIT_SettingsByShip" />
				</do_if>
			</actions>
		</cue>
		<cue name="kAAIT_InteractMenu">
			<conditions>
				<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
			</conditions>
			<actions>
				<debug_text text="'event.param.$object: ' + event.param.$object" chance="global.$kAAIT_Data.$debugChance" />
				<!-- <do_for_each name="$key" in="event.param">
					<debug_text text="$key + ': ' + '(' + typeof (event.param.{$key}) + ') ' + event.param.{$key}" chance="global.$kAAIT_Data.$debugChance" />
				</do_for_each> -->
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<debug_text text="'event.name: ' + event.name" chance="global.$kAAIT_Data.$debugChance" />
				<!-- <t id="101">Enable 'Attack all enemies'</t>
				<t id="102">Disable 'Attack all enemies'</t>
				<t id="103">Enable 'Avoid high-risk enemies'</t>
				<t id="104">Disable 'Avoid high-risk enemies'</t> -->
				<debug_text text="'$interact_ships.count: ' + $interact_ships.count" chance="global.$kAAIT_Data.$debugChance" />
				<!-- start: disable because will become reliant on uix -->
				<!-- <set_value name="$sections" exact="['kuda_interact_menu']" /> -->
				<!-- end: disable because will become reliant on uix -->
				<set_value name="$sections" exact="[]" />
				<do_if value="@kAAIT2.$IsUIXExists">
					<append_to_list name="$sections" exact="'kuda_interact_menu'" />
				</do_if>
				<do_else>
					<do_if value="$interact_ships.count == 1 and $interact_ships.{1} == $interact_target">
						<append_to_list name="$sections" exact="'main_orders'" />
					</do_if>
					<do_elseif value="@$interact_ships.count">
						<do_if value="(not $interact_target.isplayerowned) or (not $interact_target.isclass.ship)">
							<append_to_list name="$sections" exact="'selected_orders'" />
						</do_if>
						<do_else>
							<append_to_list name="$sections" exact="'selected_orders_all'" />
						</do_else>
					</do_elseif>
				</do_else>
				<set_value name="$isAllow_attackAllEnemies" exact="false" />
				<set_value name="$isDisallow_attackAllEnemies" exact="false" />
				<set_value name="$isAllow_Avoid" exact="false" />
				<set_value name="$isDisallow_Avoid" exact="false" />
				<set_value name="$isAllow_stepForwardWithdraw" exact="false" />
				<set_value name="$isDisallow_stepForwardWithdraw" exact="false" />
				<do_for_each name="$ship" in="$interact_ships">
					<do_if value="$ship.isclass.ship">
						<do_if value="@global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAllowOtherTargets_user">
							<set_value name="$isDisallow_attackAllEnemies" exact="true" />
						</do_if>
						<do_else>
							<set_value name="$isAllow_attackAllEnemies" exact="true" />
						</do_else>
						<do_if value="
							(
								(not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user?) and
								(
									(
										$ship.isclass.[class.ship_xs, class.ship_s, class.ship_m] and
										global.$kAAIT_Data.$xssm_isAvoidHighRisk
									) or
									(
										$ship.isclass.[class.ship_l, class.ship_xl] and
										(
											global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip or
											global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation
										)
									)
								)
							) or
							@global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user
						">
							<set_value name="$isDisallow_Avoid" exact="true" />
						</do_if>
						<do_else>
							<set_value name="$isAllow_Avoid" exact="true" />
						</do_else>
						<do_if value="$ship.isclass.[class.ship_l, class.ship_xl]">
							<do_if value="
								(
									(not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user?) and
									(
										global.$kAAIT_Data.$lxl_isStepForward_vShip or
										global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip or
										global.$kAAIT_Data.$lxl_isStepForward_vStation or
										global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation
									)
								) or
								@global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user
							">
								<set_value name="$isDisallow_stepForwardWithdraw" exact="true" />
							</do_if>
							<do_else>
								<set_value name="$isAllow_stepForwardWithdraw" exact="true" />
							</do_else>
						</do_if>
						<do_if value="
							$isAllow_attackAllEnemies and
							$isDisallow_attackAllEnemies and
							$isAllow_Avoid and 
							$isDisallow_Avoid and
							$isAllow_stepForwardWithdraw and 
							$isDisallow_stepForwardWithdraw">
							<break />
						</do_if>
					</do_if>
				</do_for_each>
				<!-- <debug_text text="'$isAllow_attackAllEnemies: ' + $isAllow_attackAllEnemies" /> -->
				<!-- <debug_text text="'$isDisallow_attackAllEnemies: ' + $isDisallow_attackAllEnemies" /> -->
				<do_for_each name="$section" in="$sections">
					<do_if value="$isAllow_attackAllEnemies">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_attack_all_section_' + $section,
							$section = $section,
							$text = {1111920, 101},
							$icon = 'widget_tick_01',
							$callback = kAAIT_Attack_all_enemies
						]" />
					</do_if>
					<do_if value="$isDisallow_attackAllEnemies">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_attack_one_section_' + $section,
							$section = $section,
							$text = {1111920, 102},
							$icon = 'widget_cross_01',
							$callback = kAAIT_Attack_one_only
						]" />
					</do_if>
					<do_if value="$isAllow_Avoid">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_allow_avoid_' + $section,
							$section = $section,
							$text = {1111920, 103},
							$icon = 'widget_tick_01',
							$callback = kAAIT_Enable_Avoid_high_risk
						]" />
					</do_if>
					<do_if value="$isDisallow_Avoid">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_disallow_avoid_' + $section,
							$section = $section,
							$text = {1111920, 104},
							$icon = 'widget_cross_01',
							$callback = kAAIT_Disable_Avoid_high_risk
						]" />
					</do_if>
					<do_if value="$isAllow_stepForwardWithdraw">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_allow_sfw_' + $section,
							$section = $section,
							$text = {1111920, 116},
							$icon = 'widget_tick_01',
							$callback = kAAIT_Enable_Step_foward_withdraw
						]" />
					</do_if>
					<do_if value="$isDisallow_stepForwardWithdraw">
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'kaait_disallow_sfw_' + $section,
							$section = $section,
							$text = {1111920, 117},
							$icon = 'widget_cross_01',
							$callback = kAAIT_Disable_Step_foward_withdraw
						]" />
					</do_if>
				</do_for_each>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Attack_all_enemies" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_for_each name="$order" in="$ship.orders">
							<do_if value="$order.$allowothertargets?">
								<!-- <set_value name="$order.$allowothertargets" exact="true" /> -->
								<edit_order_param order="$order" param="'allowothertargets'" value="true" />
							</do_if>
						</do_for_each>
						<!-- <debug_text text="$ship.idcode + ': ' + @global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" /> -->
						<do_if value="not @global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}">
							<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" exact="table[]" />
						</do_if>
						<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAllowOtherTargets_user" exact="true" />
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Attack_one_only" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_for_each name="$order" in="$ship.orders">
							<do_if value="$order.$allowothertargets?">
								<!-- <set_value name="$order.$allowothertargets" exact="false" /> -->
								<edit_order_param order="$order" param="'allowothertargets'" value="false" />
							</do_if>
						</do_for_each>
						<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAllowOtherTargets_user" />
						<!-- <set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAllowOtherTargets_user" exact="false" /> -->
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Enable_Avoid_high_risk" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_for_each name="$order" in="$ship.orders">
							<do_if value="$order.$kAAITParam_isAvoidHighRisk?">
								<edit_order_param order="$order" param="'kAAITParam_isAvoidHighRisk'" value="true" />
							</do_if>
						</do_for_each>
						<do_if value="$ship.defaultorder.$kAAITParam_isAvoidHighRisk?">
							<edit_order_param order="$ship.defaultorder" param="'kAAITParam_isAvoidHighRisk'" value="true" />
						</do_if>
						<do_if value="not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}?">
							<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" exact="table[]" />
						</do_if>
						<do_if value="
							(
								$ship.isclass.[class.ship_xs, class.ship_s, class.ship_m] and
								@global.$kAAIT_Data.$xssm_isAvoidHighRisk
							) or
							(
								$ship.isclass.[class.ship_l, class.ship_xl] and
								(
									@global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip or
									@global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation
								)
							)
						">
							<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user" />
						</do_if>
						<do_else>
							<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user" exact="true" />
							<add_to_group groupname="global.$kAAIT_Data.$ships" object="$ship" />
						</do_else>
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Disable_Avoid_high_risk" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_for_each name="$order" in="$ship.orders">
							<do_if value="$order.$kAAITParam_isAvoidHighRisk?">
								<edit_order_param order="$order" param="'kAAITParam_isAvoidHighRisk'" value="false" />
							</do_if>
						</do_for_each>
						<do_if value="$ship.defaultorder.$kAAITParam_isAvoidHighRisk?">
							<edit_order_param order="$ship.defaultorder" param="'kAAITParam_isAvoidHighRisk'" value="false" />
						</do_if>
						<do_for_each name="$order" in="$ship.orders" reverse="true">
							<do_if value="@$order.$kAAITParam_iskAAITOrder">
								<cancel_order order="$order" />
							</do_if>
						</do_for_each>
						<do_if value="not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}?">
							<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" exact="table[]" />
						</do_if>
						<do_if value="
							(
								$ship.isclass.[class.ship_xs, class.ship_s, class.ship_m] and
								(not @global.$kAAIT_Data.$xssm_isAvoidHighRisk)
							) or
							(
								$ship.isclass.[class.ship_l, class.ship_xl] and
								(not @global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip) and
								(not @global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation)
							)
						">
							<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user" />
						</do_if>
						<do_else>
							<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isAvoidHighRisk_user" exact="false" />
							<add_to_group groupname="global.$kAAIT_Data.$ships" object="$ship" />
						</do_else>
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Enable_Step_foward_withdraw" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_if value="$ship.isclass.[class.ship_l, class.ship_xl]">
							<do_for_each name="$order" in="$ship.orders">
								<do_if value="$order.$kAAITParam_isStepForwardWithdraw?">
									<edit_order_param order="$order" param="'kAAITParam_isStepForwardWithdraw'" value="true" />
								</do_if>
							</do_for_each>
							<do_if value="$ship.defaultorder.$kAAITParam_isStepForwardWithdraw?">
								<edit_order_param order="$ship.defaultorder" param="'kAAITParam_isStepForwardWithdraw'" value="true" />
							</do_if>
							<do_if value="not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}?">
								<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" exact="table[]" />
							</do_if>
							<do_if value="
								(
									$ship.isclass.[class.ship_l, class.ship_xl] and
									(
										@global.$kAAIT_Data.$lxl_isStepForward_vShip or
										@global.$kAAIT_Data.$lxl_isStepForward_vStation or
										@global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip or
										@global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation
									)
								)
							">
								<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user" />
							</do_if>
							<do_else>
								<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user" exact="true" />
								<add_to_group groupname="global.$kAAIT_Data.$ships" object="$ship" />
							</do_else>
						</do_if>
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Disable_Step_foward_withdraw" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<do_if value="$interact_ships.count">
					<debug_text text="'$interact_ships: ' + $interact_ships" chance="global.$kAAIT_Data.$debugChance" />
					<do_for_each name="$ship" in="$interact_ships">
						<do_if value="$ship.isclass.[class.ship_l, class.ship_xl]">
							<do_for_each name="$order" in="$ship.orders">
								<do_if value="$order.$kAAITParam_isStepForwardWithdraw?">
									<edit_order_param order="$order" param="'kAAITParam_isStepForwardWithdraw'" value="false" />
								</do_if>
							</do_for_each>
							<do_if value="$ship.defaultorder.$kAAITParam_isStepForwardWithdraw?">
								<edit_order_param order="$ship.defaultorder" param="'kAAITParam_isStepForwardWithdraw'" value="false" />
							</do_if>
							<do_for_each name="$order" in="$ship.orders" reverse="true">
								<do_if value="@$order.$kAAITParam_iskAAITOrder">
									<cancel_order order="$order" />
								</do_if>
							</do_for_each>
							<do_if value="not global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}?">
								<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}" exact="table[]" />
							</do_if>
							<do_if value="
								(
									(not @global.$kAAIT_Data.$lxl_isStepForward_vShip) and
									(not @global.$kAAIT_Data.$lxl_isStepForward_vStation) and
									(not @global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip) and
									(not @global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation)
								)
							">
								<remove_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user" />
							</do_if>
							<do_else>
								<set_value name="global.$kAAIT_Data.$byShipId.{'$' + $ship.idcode}.$kAAIT_isStepForwardWithdraw_user" exact="false" />
								<add_to_group groupname="global.$kAAIT_Data.$ships" object="$ship" />
							</do_else>
						</do_if>
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<!--
			888888 Yb  dP 888888 888888 88b 88 .dP"Y8 88  dP"Yb  88b 88      dP"Yb  88""Yb 888888 88  dP"Yb  88b 88 .dP"Y8
			88__    YbdP    88   88__   88Yb88 `Ybo." 88 dP   Yb 88Yb88     dP   Yb 88__dP   88   88 dP   Yb 88Yb88 `Ybo."
			88""    dPYb    88   88""   88 Y88 o.`Y8b 88 Yb   dP 88 Y88     Yb   dP 88"""    88   88 Yb   dP 88 Y88 o.`Y8b
			888888 dP  Yb   88   888888 88  Y8 8bodP' 88  YbodP  88  Y8      YbodP  88       88   88  YbodP  88  Y8 8bodP'
		 -->
		<cue name="kAAIT_ExtOpts">
			<conditions>
				<event_cue_signalled cue="md.Simple_Menu_Options.Reloaded"/>
			</conditions>
			<actions>
				<signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
					param="table[
						$id = 'kuertee_aait.kAAIT2_Config.on_options_menu',
						$columns = 2,
						$title = {1111920, 1},
						$onOpen = kAAIT_ExtOpts_Build
					]" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_ExtOpts_Build">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<!-- <t id="1">kuertee: Attack AI tweaks</t>
				<t id="2">Debug log</t>
				<t id="3">Avoid high-risk</t>
				<t id="4">Player faction</t>
				<t id="5">All other factions</t>
				<t id="6">Step forward on no damage</t>
				<t id="7">Move out of range on damage</t>
				<t id="8">XS, S, and M ships</t>
				<t id="9">L, and XL ships</t>
				<t id="10">Optimal weapon range is max weapon range</t> -->
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 8}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 3}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'xssm_isAvoidHighRisk',
						$checked = global.$kAAIT_Data.$xssm_isAvoidHighRisk,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'xssm_isAvoidHighRisk_allFactions',
						$checked = global.$kAAIT_Data.$xssm_isAvoidHighRisk_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>

				<!-- <t id="11">Attack when more than this turret count</t>
				<t id="12">Against high-risk ships</t>
				<t id="13">Against high-risk stations</t> -->
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 11}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 12}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_Slider"
					param = "table[
						$id = 'xss_outnumberVShips',
						$start = global.$kAAIT_Data.$xss_outnumberVShips,
						$col = 2,
						$text = table[$text=''],
						$min = 0, $max = 200, $step = 1, $suffix='%',
						$default = 25,
						$mouseOverText = {1001,2661} + ': 25',
						$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
					]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 13}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_Slider"
					param = "table[
						$id = 'xss_outnumberVStations',
						$start = global.$kAAIT_Data.$xss_outnumberVStations,
						$col = 2,
						$text = table[$text=''],
						$min = 0, $max = 200, $step = 1, $suffix='%',
						$default = 75,
						$mouseOverText = {1001,2661} + ': 75',
						$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
					]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 14}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 12}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_Slider"
					param = "table[
						$id = 'm_outnumberVShips',
						$start = global.$kAAIT_Data.$m_outnumberVShips,
						$col = 2,
						$text = table[$text=''],
						$min = 0, $max = 200, $step = 1, $suffix='%',
						$default = 50,
						$mouseOverText = {1001,2661} + ': 50',
						$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
					]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 13}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_Slider"
					param = "table[
						$id = 'm_outnumberVStations',
						$start = global.$kAAIT_Data.$m_outnumberVStations,
						$col = 2,
						$text = table[$text=''],
						$min = 0, $max = 200, $step = 1, $suffix='%',
						$default = 75,
						$mouseOverText = {1001,2661} + ': 75',
						$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
					]" />

				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 9}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 114}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isAvoidHighRisk_vShip',
						$checked = global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isAvoidHighRisk_vShip_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 115}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isAvoidHighRisk_vStation',
						$checked = global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isAvoidHighRisk_vStation_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<!-- <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 110}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isStepForward_vShip',
						$checked = global.$kAAIT_Data.$lxl_isStepForward_vShip,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isStepForward_vShip_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isStepForward_vShip_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/> -->
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 111}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isStepForward_vStation',
						$checked = global.$kAAIT_Data.$lxl_isStepForward_vStation,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isStepForward_vStation_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isStepForward_vStation_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 112}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isMoveOutOfRange_vShip',
						$checked = global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isMoveOutOfRange_vShip_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isMoveOutOfRange_vShip_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 113}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isMoveOutOfRange_vStation',
						$checked = global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'lxl_isMoveOutOfRange_vStation_allFactions',
						$checked = global.$kAAIT_Data.$lxl_isMoveOutOfRange_vStation_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 16}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 4}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'isCarriersAttackLikeDestroyers',
						$checked = global.$kAAIT_Data.$isCarriersAttackLikeDestroyers,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 5}, $halign='right', $color='Helper.color.blue']" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'isCarriersAttackLikeDestroyers_allFactions',
						$checked = global.$kAAIT_Data.$isCarriersAttackLikeDestroyers_allFactions,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>

				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 15}]" />
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'isUseNPCSkills',
						$checked = global.$kAAIT_Data.$isUseNPCSkills,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>

				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={1111920, 2}, $color='Helper.color.red']"/>
				<signal_cue_instantly
					cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'debugChance',
						$checked = if global.$kAAIT_Data.$debugChance == 100 then true else false,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$bgColor = 'Helper.color.red',
						$onClick = kAAIT_ExtOpts_OnCheckboxChange
					]"/>

				<do_if value="global.$kAAIT_Data.$debugChance">
					<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']"/>
					<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='Optimisation']" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='Higher settings = less frequent detections = better performance = slower reactions to potential high-risk enemies', $wordwrap = true]" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='Hit event detection frequency', $halign='right', $color='Helper.color.blue']" />
					<signal_cue_instantly
						cue = "md.Simple_Menu_API.Make_Slider"
						param = "table[
							$id = 'optimisation_hit_event',
							$start = global.$kAAIT_Data.$optimisation_hit_event,
							$col = 2,
							$text = table[$text=''],
							$min = 0.25, $max = 3, $step = 0.25, $suffix='s',
							$default = 0.25,
							$mouseOverText = {1001,2661} + ': 1',
							$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
						]" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='Radar event detection frequency', $halign='right', $color='Helper.color.blue']" />
					<signal_cue_instantly
						cue = "md.Simple_Menu_API.Make_Slider"
						param = "table[
							$id = 'optimisation_radar_event',
							$start = global.$kAAIT_Data.$optimisation_radar_event,
							$col = 2,
							$text = table[$text=''],
							$min = 0.25, $max = 3, $step = 0.25, $suffix='s',
							$default = 0.25,
							$mouseOverText = {1001,2661} + ': 1',
							$onSliderCellChanged = kAAIT_ExtOpts_OnSliderChange
						]" />
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_ExtOpts_OnSliderChange" instantiate="true">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' pre: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<set_value name="global.$kAAIT_Data.{'$' + event.param.$id}" exact="event.param.$value" />
				<debug_text text="event.param.$id + ' post: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<cancel_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_ExtOpts_OnCheckboxChange">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' pre: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<do_if value="event.param.$id == 'debugChance'">
					<set_value name="global.$kAAIT_Data.{'$' + event.param.$id}" exact="if event.param.$checked then 100 else 0" />
				</do_if>
				<do_else>
					<set_value name="global.$kAAIT_Data.{'$' + event.param.$id}" exact="event.param.$checked" />
				</do_else>
				<debug_text text="event.param.$id + ' post: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_ExtOpts_OnDropDownConfirmed">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' to: ' + @event.param.$option.$text + ' value: ' + @event.param.$option.$value" chance="global.$kAAIT_Data.$debugChance" />
				<debug_text text="event.param.$id + ' pre: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<set_value name="global.$kAAIT_Data.{'$' + event.param.$id}" exact="(event.param.$option.$value)" />
				<debug_text text="event.param.$id + ' post: ' + global.$kAAIT_Data.{'$' + event.param.$id}" chance="global.$kAAIT_Data.$debugChance"/>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<!--
			8888b.  888888 88""Yb 88   88  dP""b8
			 8I  Yb 88__   88__dP 88   88 dP   `"
			 8I  dY 88""   88""Yb Y8   8P Yb  "88
			8888Y"  888888 88oodP `YbodP'  YboodP
		 -->
		<cue name="kAAIT_Debug2" namespace="this">
			<conditions>
				<event_ui_triggered screen="'Chat_Window_API'" control="'text_entered'" />
				<check_any>
					<check_value value="event.param3.$text == 'debug aait enable'" />
					<check_value value="event.param3.$text == 'debug aait disable'" />
					<check_value value="event.param3.$text == 'debug aait modules'" />
					<check_value value="event.param3.$text == 'debug aait forward'" />
					<check_value value="event.param3.$text == 'debug aait forward2'" />
					<check_value value="event.param3.$text == 'debug aait forward3'" />
					<check_value value="event.param3.$text == 'debug aait forward4'" />
					<check_value value="event.param3.$text == 'debug aait beacon'" />
					<check_value value="event.param3.$text == 'debug aait dps'" />
					<check_value value="event.param3.$text == 'debug aait attackers'" />
					<check_value value="event.param3.$text == 'debug aait target'" />
				</check_any>
			</conditions>
			<actions>
				<debug_text text="event.param3" />
				<do_if value="event.param3.$text == 'debug aait enable'">
					<set_value name="global.$kAAIT_Data.$debugChance" exact="100" />
				</do_if>
				<do_elseif value="event.param3.$text == 'debug aait disable'">
					<set_value name="global.$kAAIT_Data.$debugChance" exact="0" />
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait modules'">
					<find_object_component object="player.target" name="$kAAIT_modules" multiple="true" class="class.module" checkoperational="true" />
					<do_for_each name="$module_inList" in="$kAAIT_modules">
						<debug_text text="'$module_inList.hullpercentage: ' + $module_inList.hullpercentage" />
					</do_for_each>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait forward'">
					<!-- point on a line
					https://math.stackexchange.com/questions/251792/vector-equation-spelled-out?noredirect=1&lq=1
					v=(x1,y1)(x0,y0)
					v=(9,13)(3,4)=(6,9)
					||v||=squareroot(6^2+9^2)10.8
					u=v/||v||(0.55,0.83)
					from (3,4) will be (3,4)+3u, or about (4.66,6.50).
					-->
					<create_position name="$pos_ship" space="player.ship.sector" object="player.ship" />
					<create_position name="$pos_target" space="player.ship.sector" object="player.target" />
					<create_position name="$v_shipToTarget" space="player.ship.sector"
						x="$pos_target.x - $pos_ship.x"
						y="$pos_target.y - $pos_ship.y"
						z="$pos_target.z - $pos_ship.z"
					/>
					<set_value name="$dist_shipToTarget" exact="player.ship.distanceto.{player.target}" />
					<create_position name="$u_shipToTarget" space="player.ship.sector"
						x="$v_shipToTarget.x / $dist_shipToTarget"
						y="$v_shipToTarget.y / $dist_shipToTarget"
						z="$v_shipToTarget.z / $dist_shipToTarget"
					/>
					<create_position name="$pos_inchFront" space="player.ship.sector"
						x="$pos_ship.x + $u_shipToTarget.x * player.ship.size"
						y="$pos_ship.y + $u_shipToTarget.y * player.ship.size"
						z="$pos_ship.z + $u_shipToTarget.z * player.ship.size"
					/>
					<do_if value="@parent.$beacon">
						<destroy_object object="parent.$beacon" />
					</do_if>
					<create_object name="parent.$beacon" sector="player.ship.sector" macro="macro.env_deco_nav_beacon_t1_macro" owner="faction.player">
						<position value="$pos_inchFront" />
					</create_object>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait forward2'">
					<!-- from point 1, get point 2 at distance and vector
					https://stackoverflow.com/questions/52781607/3d-point-from-two-angles-and-a-distance
					Px = distance * sin(yaw) * cos(pitch) 
					Py = distance * sin(pitch) 
					Pz = distance * cos(yaw) * cos(pitch)
					-->
					<create_position name="$pos_ship" space="player.ship.sector" object="player.ship" />
					<create_position name="$pos_inchFront" space="player.ship.sector"
						x="$pos_ship.x + player.ship.size * sin (player.ship.rotation.yaw) * cos (player.ship.rotation.pitch)"
						y="$pos_ship.y + player.ship.size * sin (player.ship.rotation.pitch)"
						z="$pos_ship.z + player.ship.size * cos (player.ship.rotation.yaw) * cos (player.ship.rotation.pitch)"
					/>
					<do_if value="@parent.$beacon">
						<destroy_object object="parent.$beacon" />
					</do_if>
					<create_object name="parent.$beacon" sector="player.ship.sector" macro="macro.env_deco_nav_beacon_t1_macro" owner="faction.player">
						<position value="$pos_inchFront" />
					</create_object>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait forward3'">
					<!-- from point 1, get point 2 at distance and vector
					https://stackoverflow.com/questions/52781607/3d-point-from-two-angles-and-a-distance
					Px = distance * sin(yaw) * cos(pitch) 
					Py = distance * sin(pitch) 
					Pz = distance * cos(yaw) * cos(pitch)
					-->
					<create_position name="$pos_ship" space="player.ship.sector" object="player.ship" />
					<create_position name="$pos_target" space="player.ship.sector" object="player.target" />
					<create_orientation name="$rot_shipToTarget" orientation="look_at" refposition="$pos_target">
						<position object="player.ship" space="player.ship.sector"/>
					</create_orientation>
					<create_position name="$pos_inchFront" space="player.ship.sector"
						x="$pos_ship.x + player.ship.size * sin ($rot_shipToTarget.yaw) * cos ($rot_shipToTarget.pitch)"
						y="$pos_ship.y + player.ship.size * sin ($rot_shipToTarget.pitch)"
						z="$pos_ship.z + player.ship.size * cos ($rot_shipToTarget.yaw) * cos ($rot_shipToTarget.pitch)"
					/>
					<do_if value="@parent.$beacon">
						<destroy_object object="parent.$beacon" />
					</do_if>
					<create_object name="parent.$beacon" sector="player.ship.sector" macro="macro.env_deco_nav_beacon_t1_macro" owner="faction.player">
						<position value="$pos_inchFront" />
					</create_object>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait forward4'">
					<create_position name="$pos_ship" space="player.target.sector" object="player.target" />
					<find_gravidar_contact name="$enemies" object="player.target" class="[class.ship_l, class.ship_xl, class.station]" docked="false" functional="true" maybeattackedby="player.target" multiple="true" sortbydistanceto="player.target">
						<match_context macro="this.sector.macro"/>
						<match class="class.buildstorage" negate="true"/>
					</find_gravidar_contact>
					<set_value name="$object_other" exact="$enemies.{1}" />
					<create_position name="$pos_target" space="player.target.sector" object="$object_other" />
					<create_orientation name="$rot_shipToTarget" orientation="look_at" refposition="$pos_target">
						<position object="player.target" space="player.target.sector"/>
					</create_orientation>
					<create_position name="$pos_inchFront" space="player.target.sector"
						x="$pos_ship.x + player.target.size * 2 * sin ($rot_shipToTarget.yaw) * cos ($rot_shipToTarget.pitch)"
						y="$pos_ship.y + player.target.size * 2 * sin ($rot_shipToTarget.pitch)"
						z="$pos_ship.z + player.target.size * 2 * cos ($rot_shipToTarget.yaw) * cos ($rot_shipToTarget.pitch)"
					/>
					<do_if value="@parent.$beacon">
						<destroy_object object="parent.$beacon" />
					</do_if>
					<create_object name="parent.$beacon" sector="player.target.sector" macro="macro.env_deco_nav_beacon_t1_macro" owner="faction.player">
						<position value="$pos_inchFront" />
					</create_object>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait beacon'">
					<do_if value="@parent.$beacon">
						<destroy_object object="parent.$beacon" />
					</do_if>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait dps'">
					<debug_text text="'$dps: ' + player.target.dps.all" />
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait attackers'">
					<!-- <debug_text text="@global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_attackers" /> -->
					<run_actions ref="DebugData">
						<param name="Data" value="@global.$kAAIT_Data.$ships" />
						<param name="Prefix" value="'global.$kAAIT_Data.$ships'" />
					</run_actions>
					<run_actions ref="DebugData">
						<param name="Data" value="@global.$kAAIT_Data.$byShipId" />
						<param name="Prefix" value="'global.$kAAIT_Data.$byShipId'" />
					</run_actions>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait target'">
					<debug_text text="@global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target + ' ' + @global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target.knownname + ' ' + @global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target.idcode + ' ' + @global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target.defensible + ' ' + @global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target.defensible.knownname + ' ' + @global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$kAAIT_target.defensible.idcode" />
				</do_elseif>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<library name="DebugData" purpose="run_actions">
			<params>
				<param name="Data" />
				<param name="Depth" default="1" />
				<param name="Prefix" default="''" />
			</params>
			<actions>
				<set_value name="$indent" exact="''" />
				<do_all counter="$i" exact="$Depth - 1">
					<set_value name="$indent" exact="$indent + '    '" />
				</do_all>
				<do_if value="@$Prefix.knownname">
					<set_value name="$Prefix" exact="$Prefix + ' (' + $Prefix.knownname + ')'" />
				</do_if>
				<do_elseif value="@$Prefix.name">
					<set_value name="$Prefix" exact="$Prefix + ' (' + $Prefix.name + ')'" />
				</do_elseif>
				<do_if value="@$Data.knownname">
					<set_value name="$Data" exact="$Data + ' (' + $Data.knownname + ')'" />
				</do_if>
				<do_elseif value="@$Data.name">
					<set_value name="$Data" exact="$Data + ' (' + $Data.name + ')'" />
				</do_elseif>
				<debug_text text="$indent + $Prefix + ': ' + $Data" />
				<do_if value="(typeof $Data == datatype.list) or (typeof $Data == datatype.group)">
					<do_for_each name="$item" in="$Data" counter="$i">
						<run_actions ref="DebugData">
							<param name="Data" value="$item" />
							<param name="Depth" value="$Depth + 1" />
							<param name="Prefix" value="$i" />
						</run_actions>
					</do_for_each>
				</do_if>
				<do_elseif value="typeof $Data == datatype.table">
					<do_for_each name="$key" valuename="$value" in="$Data">
						<run_actions ref="DebugData">
							<param name="Data" value="$value" />
							<param name="Depth" value="$Depth + 1" />
							<param name="Prefix" value="$key" />
						</run_actions>
					</do_for_each>
				</do_elseif>
			</actions>
		</library>
		<cue name="Debug2_DestroyWeapons">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<debug_text text="'$interact_target: ' + $interact_target + ' (' + $interact_target.knownname + ')'" />
				<do_if value="$interact_target.isclass.ship">
					<set_value name="$weapons" exact="$interact_target.weapons.operational.list" />
				</do_if>
				<do_else>
					<set_value name="$weapons" exact="
						@$interact_target.weapons.operational.count + 
						[@$interact_target.weapons.operational.count, @$interact_target.turrets.operational.count].max
					" />
				</do_else>
				<do_if value="$interact_target.isclass.station">
					<append_list_elements name="$weapons" other="$interact_target.turrets.operational.list" />
				</do_if>
				<do_all counter="$i" exact="[25, $weapons.count].min">
					<destroy_object object="$weapons.{$i}" />
				</do_all>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="Debug2_DebugAllShip">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="kAAIT2.$debugChance_idCode" exact="'all'" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="Debug2_DebugThisShip">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<debug_text text="'$interact_target: ' + $interact_target + ' (' + @$interact_target.knownname + ', ' + @$interact_target.idcode + ')'" />
				<set_value name="kAAIT2.$debugChance_idCode" exact="$interact_target.idcode" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="Debug2_UndebugThisShip">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<remove_value name="kAAIT2.$debugChance_idCode" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="Debug_ShowShipData" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$ship" exact="@event.param.$object" />
				<debug_text text="'$ship: ' + $ship.knownname + ' (' + $ship.idcode + ')'" />
				<debug_text text="'$ship.type: ' + @$ship.type" />
				<debug_text text="'$escortgroup: ' + @$ship.assignedaipilot.$escortgroup" />
				<debug_text text="'assignedaipilot: ' + @$ship.assignedaipilot.knownname" />
				<debug_text text="'defencenpc: ' + @$ship.defencenpc.knownname" />
				<set_value name="$entity" exact="$ship.assignedaipilot" />
				<do_if value="not $entity">
					<set_value name="$entity" exact="$ship.defencenpc" />
				</do_if>
				<debug_text text="'entity: ' + @$entity.knownname + ' exists: ' + @$entity.exists + ' isoperational: ' + @$entity.isoperational" />
				<!-- <do_if value="@$entity.$kAAIT_attackers_timeAdded"> -->
					<run_actions ref="DebugData">
						<param name="Data" value="(player.age - @$entity.$kAAIT_attackers_timeAdded) + ' seconds ago'" />
						<param name="Prefix" value="'$kAAIT_attackers_timeAdded'" />
					</run_actions>
					<run_actions ref="DebugData">
						<param name="Data" value="@$entity.$kAAIT_attackers" />
						<param name="Prefix" value="'$kAAIT_attackers'" />
					</run_actions>
					<run_actions ref="DebugData">
						<param name="Data" value="@$entity.$kAAIT_attackers_lxl" />
						<param name="Prefix" value="'$kAAIT_attackers_lxl'" />
					</run_actions>
				<!-- </do_if> -->
				<debug_text text="'size: ' + $ship.size" />
				<debug_text text="'primarypurpose: ' + $ship.primarypurpose" />
				<debug_text text="'order: ' + $ship.order + ' ' + @$ship.order.script" />
				<debug_text text="'    $ship.order.istemporary: ' + @$ship.order.istemporary" />
				<debug_text text="'    $ship.order.$kAAITParam_iskAAITOrder: ' + @$ship.order.$kAAITParam_iskAAITOrder" />
				<debug_text text="'    $ship.order.$kAAITParam_isAvoidHighRisk: ' + @$ship.order.$kAAITParam_isAvoidHighRisk" />
				<debug_text text="'    $ship.order.$kAAITParam_isStepForwardWithdraw: ' + @$ship.order.$kAAITParam_isStepForwardWithdraw" />
				<debug_text text="'    $ship.order.$radiusanchorspace: ' + @$ship.order.$radiusanchorspace" />
				<debug_text text="'    $ship.order.$radiusanchorpos: ' + @$ship.order.$radiusanchorpos" />
				<debug_text text="'    $ship.order.$radius: ' + @$ship.order.$radius" />
				<debug_text text="'    $ship.distanceto.[$ship.order.$radiusanchorspace, $ship.order.$radiusanchorpos]: ' + @$ship.distanceto.[$ship.order.$radiusanchorspace, $ship.order.$radiusanchorpos]" />
				<debug_text text="'    $ship.defaultorder: ' + @$ship.defaultorder" />
				<debug_text text="'orders.{2}: ' + @$ship.orders.{2} + ' ' + @$ship.orders.{2}.script" />
				<debug_text text="'    $ship.orders.{2}.istemporary: ' + @$ship.orders.{2}.istemporary" />
				<debug_text text="'    $ship.orders.{2}.$kAAITParam_iskAAITOrder: ' + @$ship.orders.{2}.$kAAITParam_iskAAITOrder" />
				<debug_text text="'    $ship.orders.{2}.$kAAITParam_isAvoidHighRisk: ' + @$ship.orders.{2}.$kAAITParam_isAvoidHighRisk" />
				<debug_text text="'    $ship.orders.{2}.$kAAITParam_isStepForwardWithdraw: ' + @$ship.orders.{2}.$kAAITParam_isStepForwardWithdraw" />
				<debug_text text="'defaultorder: ' + $ship.defaultorder + ' ' + @$ship.defaultorder.script" />
				<debug_text text="'    $ship.defaultorder.istemporary: ' + @$ship.defaultorder.istemporary" />
				<debug_text text="'    $ship.defaultorder.$kAAITParam_iskAAITOrder: ' + @$ship.defaultorder.$kAAITParam_iskAAITOrder" />
				<debug_text text="'    $ship.defaultorder.$kAAITParam_isAvoidHighRisk: ' + @$ship.defaultorder.$kAAITParam_isAvoidHighRisk" />
				<debug_text text="'    $ship.defaultorder.$kAAITParam_isStepForwardWithdraw: ' + @$ship.defaultorder.$kAAITParam_isStepForwardWithdraw" />
				<create_position name="$pos" space="$ship.sector" object="$ship" />
				<debug_text text="'$pos: ' + $pos" />
				<debug_text text="'shieldpercentage: ' + @$ship.shieldpercentage" />
				<debug_text text="'maxspeed: ' + @$ship.maxspeed" />
				<debug_text text="'travel.maxspeed: ' + @$ship.travel.maxspeed" />
				<debug_text text="'dps.all: ' + @$ship.dps.all" />
				<do_if value="@$ship.isclass.ship">
					<set_value name="$weapons" exact="@$ship.weapons.operational.count" />
				</do_if>
				<do_else>
					<set_value name="$weapons" exact="
						@$ship.weapons.operational.count + 
						[@$ship.weapons.operational.count, @$ship.turrets.operational.count].max
					" />
				</do_else>
				<debug_text text="'maxradarrange: ' + $ship.maxradarrange" />
				<debug_text text="'$weapons: ' + $weapons" />
				<debug_text text="'maxcombatrange.primary: ' + $ship.maxcombatrange.primary" />
				<debug_text text="'maxcombatrange.secondary: ' + $ship.maxcombatrange.secondary" />
				<debug_text text="'maxcombatrange.lasers.all: ' + $ship.maxcombatrange.lasers.all" />
				<debug_text text="'maxcombatrange.missiles.all: ' + $ship.maxcombatrange.missiles.all" />
				<debug_text text="'maxcombatrange.turrets: ' + $ship.maxcombatrange.turrets" />
				<!-- <debug_text text="'global.$kAAIT_Data: ' + global.$kAAIT_Data" /> -->
				<!-- <debug_text text="'global.$kAAIT_Data.$byShipId: ' + global.$kAAIT_Data.$byShipId" /> -->
				<debug_text text="'global.$kAAITByShipId: ' + @global.$kAAIT_Data.$byShipId.{'$' + @$ship.idcode}.keys.list" />
				<run_actions ref="DebugData">
					<param name="Data" value="@global.$kAAIT_Data.$byShipId.{'$' + @$ship.idcode}" />
					<param name="Prefix" value="'@global.$kAAIT_Data.$byShipId.{$' + @$ship.idcode + '}'" />
				</run_actions>
				<set_value name="$target" exact="@global.$kAAIT_Data.$byShipId.{'$' + @$ship.idcode}.$attackData.$moduleTarget" />
				<do_if value="not $target">
					<set_value name="$target" exact="@global.$kAAIT_Data.$byShipId.{'$' + @$ship.idcode}.$attackData.$defensibleTarget" />
				</do_if>
				<do_if value="not $target">
					<set_value name="$target" exact="@$ship.order.$primarytarget" />
				</do_if>
				<do_if value="not $target">
					<set_value name="$target" exact="@$ship.nextorder.$primarytarget" />
				</do_if>
				<debug_text text="'$target: ' + $target + ' (' + @$target.knownname + ', ' + @$target.idcode + ', ' + @$target.hullpercentage + ', ' + @$target.class + ')'" />
				<set_value name="$dist" exact="$ship.distanceto.{$target}" />
				<set_value name="$dist2" exact="$ship.bboxdistanceto.{$target}" />
				<debug_text text="'$dist: ' + $dist + ' $dist2 (bboxdistanceto): ' + $dist2" />
				<do_if value="$target">
					<debug_text text="'attack vectors:'" />
					<set_value name="$orderLocation_space" exact="$ship.sector" />
					<create_position name="$posShip" space="$orderLocation_space" object="$ship" />
					<create_position name="$posTarget" space="$orderLocation_space" object="$target" />
					<do_if value="$target.isrealclass.module">
						<create_position name="$posStation" space="$orderLocation_space" object="$target.defensible" />
						<create_orientation name="$rotFromTarget" orientation="look_at" refposition="$posTarget">
							<position value="$posStation" />
						</create_orientation>
						<set_value name="$kAAIT_yaw_to" exact="$rotFromTarget.yaw * 180 / pi" />
						<debug_text text="'$kAAIT_yaw_to: ' + $kAAIT_yaw_to" />
						<create_orientation name="$rotFromStation" orientation="look_at" refposition="$posShip">
							<position value="$posStation" />
						</create_orientation>
						<set_value name="$kAAIT_yaw_from" exact="$rotFromStation.yaw * 180 / pi" />
						<debug_text text="'$kAAIT_yaw_from: ' + $kAAIT_yaw_from" />
						<do_if value="[$kAAIT_yaw_to - $kAAIT_yaw_from, $kAAIT_yaw_from - $kAAIT_yaw_to].max ge 180">
							<do_if value="$kAAIT_yaw_from lt 0">
								<set_value name="$kAAIT_yaw_to" exact="$kAAIT_yaw_to - 360" />
							</do_if>
							<do_elseif value="$kAAIT_yaw_from gt 0">
								<set_value name="$kAAIT_yaw_to" exact="$kAAIT_yaw_to + 360" />
							</do_elseif>
						</do_if>
						<set_value name="$kAAIT_yaw_mid" exact="$kAAIT_yaw_from + ($kAAIT_yaw_to - $kAAIT_yaw_from) * 0.5" />
						<debug_text text="'$kAAIT_yaw_mid (vector halfway bet station and vector): ' + $kAAIT_yaw_mid" />
					</do_if>
					<do_else>
						<create_orientation name="$rotFromTarget" orientation="look_at" refposition="$posShip">
							<position value="$posTarget" />
						</create_orientation>
						<set_value name="$ship_yaw_deg" exact="$rotFromTarget.yaw * 180 / pi" />
						<debug_text text="'$ship_yaw_deg: ' + $ship_yaw_deg" />
					</do_else>
				</do_if>
				<debug_text text="'$kAAIT_jumpPath: ' + @$ship.assignedaipilot.$kAAIT_jumpPath" />
				<do_if value="@$ship.assignedaipilot.$kAAIT_jumpPath">
					<do_for_each name="$jumpPath" in="$ship.assignedaipilot.$kAAIT_jumpPath">
						<debug_text text="'$jumpPath: ' + $jumpPath + ' ' + @$jumpPath.knownname + ' ' + @$jumpPath.idcode + ' ' + @$jumpPath.sector.knownname" />
					</do_for_each>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugSignalResupply" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<debug_text text="'interact_target: ' + $interact_target + ', ' + $interact_target.knownname + ', ' + $interact_target.idcode" />
				<set_object_hull object="$interact_target" exact="5" />
				<set_value name="$isUrgent" exact="true" />
				<signal_objects object="$interact_target" param="'resupply'" param2="[$isUrgent]" param3="100" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugDestroyShipTarget" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<run_actions ref="DebugData">
					<param name="Data" value="global.$kAAIT_Data.$byShipId.{'$' + @$interact_target.idcode}" />
					<param name="Prefix" value="'global.$kAAIT_Data.$byShipId.{$' + @$interact_target.idcode + '}'" />
				</run_actions>
				<set_value name="$target" exact="@global.$kAAIT_Data.$byShipId.{'$' + @$interact_target.idcode}.$attackData.$moduleTarget" />
				<do_if value="not $target">
					<set_value name="$target" exact="@global.$kAAIT_Data.$byShipId.{'$' + @$interact_target.idcode}.$attackData.$defensibleTarget" />
				</do_if>
				<do_if value="not $target">
					<set_value name="$target" exact="@$interact_target.order.$primarytarget" />
				</do_if>
				<do_if value="not $target">
					<set_value name="$target" exact="@$interact_target.nextorder.$primarytarget" />
				</do_if>
				<debug_text text="'$target (pre destruction): ' + $target + ' (' + @$target.knownname + ', ' + @$target.idcode + ', ' + @$target.hullpercentage + ')'" />
				<do_if value="$target">
					<set_object_hull object="$target" exact="1" />
					<!-- <destroy_object object="$target" /> -->
				</do_if>
				<debug_text text="'$target (post destruction): ' + $target + ' (' + @$target.knownname + ', ' + @$target.idcode + ', ' + @$target.hullpercentage + ')'" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugDestroy" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<debug_text text="'interact_target: ' + $interact_target + ', ' + $interact_target.knownname + ', ' + $interact_target.idcode" />
				<destroy_object object="$interact_target" explosion="true" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugForceWithdraw" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<debug_text text="'interact_target: ' + $interact_target + ', ' + $interact_target.knownname + ', ' + $interact_target.idcode" />
				<signal_objects object="$interact_target" param="'withdraw'" />
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugIsPrimaryTargetInFront" namespace="this">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<set_value name="$primaryTarget" exact="@$interact_target.order.$primarytarget" />
				<debug_text text="'$interact_target: ' + $interact_target.knownname + ' ' + $interact_target.idcode" />
				<debug_text text="'$interact_target.rotation: ' + $interact_target.rotation" />
				<debug_text text="'$primaryTarget: ' + $primaryTarget.knownname + ' ' + $primaryTarget.idcode" />
				<do_if value="$primaryTarget">
					<create_orientation name="$rot" orientation="look_at" refobject="$primaryTarget">
						<position object="$interact_target" />
					</create_orientation>
					<set_value name="$yaw" exact="$rot.yaw * 180 / pi" />
					<set_value name="$pitch" exact="$rot.pitch * 180 / pi" />
					<debug_text text="'create_orientation from object to refobject $yaw: ' + $yaw + ' $pitch: ' + $pitch" />

					<create_position name="$pos_target" space="$interact_target" object="$primaryTarget" />
					<create_orientation name="$rot" orientation="look_at" refposition="$pos_target">
						<position value="position.[0,0,0]" />
					</create_orientation>
					<set_value name="$yaw" exact="$rot.yaw * 180 / pi" />
					<set_value name="$pitch" exact="$rot.pitch * 180 / pi" />
					<debug_text text="'create_orientation from [0,0,0] to $pos_target $yaw: ' + $yaw + ' $pitch: ' + $pitch" />

					<create_position name="$pos_self" space="$interact_target.sector" object="$interact_target" />
					<create_position name="$pos_target" space="$interact_target.sector" object="$primaryTarget" />
					<create_orientation name="$rot" orientation="look_at" refposition="$pos_target">
						<position value="$pos_self" />
					</create_orientation>
					<set_value name="$yaw" exact="$rot.yaw * 180 / pi" />
					<set_value name="$pitch" exact="$rot.pitch * 180 / pi" />
					<debug_text text="'create_orientation from $pos_self to $pos_target $yaw: ' + $yaw + ' $pitch: ' + $pitch" />
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="kAAIT_Debug_InteractMenu" namespace="this">
			<conditions>
				<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
			</conditions>
			<actions>
				<debug_text text="'event.param.$object: ' + event.param.$object" chance="global.$kAAIT_Data.$debugChance" />
				<!-- <do_for_each name="$key" in="event.param">
					<debug_text text="$key + ': ' + '(' + typeof (event.param.{$key}) + ') ' + event.param.{$key}" chance="global.$kAAIT_Data.$debugChance" />
				</do_for_each> -->
				<set_value name="$interact_ships" exact="@event.param.$selectedplayerships" />
				<do_if value="typeof ($interact_ships) != datatype.list">
					<set_value name="$interact_ships" exact="[]" />
				</do_if>
				<set_value name="$interact_target" exact="@event.param.$object" />
				<do_if value="$interact_target.isplayerowned">
					<append_to_list name="$interact_ships" exact="$interact_target" />
				</do_if>
				<debug_text text="'event.name: ' + event.name" chance="global.$kAAIT_Data.$debugChance" />
				<do_if value="@$interact_target.exists">
					<debug_text text="'$interact_target: ' + @$interact_target + ' (' + @$interact_target.knownname + ')'" chance="global.$kAAIT_Data.$debugChance" />
					<do_if value="global.$kAAIT_Data.$debugChance">
						<set_value name="$section" exact="'main'" />
						<do_if value="kAAIT2.$IsUIXExists">
							<set_value name="$section" exact="'kuda_interact_menu'" />
						</do_if>
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'Debug2_DebugAllShip',
							$section = $section,
							$text = 'Debug2_DebugAllShip',
							$icon = null,
							$callback = Debug2_DebugAllShip
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'Debug2_DebugThisShip',
							$section = $section,
							$text = 'Debug2_DebugThisShip',
							$icon = null,
							$callback = Debug2_DebugThisShip
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'Debug2_UndebugThisShip',
							$section = $section,
							$text = 'Debug2_UndebugThisShip',
							$icon = null,
							$callback = Debug2_UndebugThisShip
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'Debug_ShowShipData',
							$section = $section,
							$text = 'Debug_ShowShipData',
							$icon = null,
							$callback = Debug_ShowShipData
						]" />
						<do_if value="@$ship.isclass.ship">
							<set_value name="$weapons" exact="@$ship.weapons.operational.count" />
						</do_if>
						<do_else>
							<set_value name="$weapons" exact="
								@$ship.weapons.operational.count + 
								[@$ship.weapons.operational.count, @$ship.turrets.operational.count].max
							" />
						</do_else>
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'Debug2_DestroyWeapons',
							$section = $section,
							$text = 'Debug2_DestroyWeapons ' + [$weapons, 25].min + ' of ' + $weapons + ' weapons',
							$icon = null,
							$callback = Debug2_DestroyWeapons
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'DebugSignalResupply',
							$section = $section,
							$text = 'DebugSignalResupply',
							$icon = null,
							$callback = DebugSignalResupply
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'DebugDestroy',
							$section = $section,
							$text = 'DebugDestroy',
							$icon = null,
							$callback = DebugDestroy
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'DebugDestroyShipTarget',
							$section = $section,
							$text = 'DebugDestroyShipTarget',
							$icon = null,
							$callback = DebugDestroyShipTarget
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'DebugForceWithdraw',
							$section = $section,
							$text = 'DebugForceWithdraw',
							$icon = null,
							$callback = DebugForceWithdraw
						]" />
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
							$id = 'DebugIsPrimaryTargetInFront',
							$section = $section,
							$text = 'DebugIsPrimaryTargetInFront',
							$icon = null,
							$callback = DebugIsPrimaryTargetInFront
						]" />
					</do_if>
				</do_if>
				<reset_cue cue="this" />
			</actions>
		</cue>
		<cue name="DebugChat">
			<conditions>
				<check_all>
					<event_ui_triggered screen="'Chat_Window_API'" control="'text_entered'" />
					<check_any>
						<check_value value="event.param3.$text == 'debug aait data'" />
						<check_value value="event.param3.$text == 'debug aait bombers'" />
						<check_value value="event.param3.$text == 'debug aait gun count'" />
						<check_value value="event.param3.$text == 'debug aait engage pos'" />
						<check_value value="event.param3.$text == 'debug aait engage pos2'" />
						<check_value value="event.param3.$text == 'debug aait orders'" />
						<check_value value="event.param3.$text == 'debug aait ships'" />
						<check_value value="event.param3.$text == 'debug aait eta'" />
					</check_any>
				</check_all>
			</conditions>
			<actions>
				<debug_text text="@event.param3" />
				<do_if value="event.param3.$text == 'debug aait data'">
					<debug_text text="player.target + ': ' + player.target.knownname + ', ' + player.target.idcode" />
					<do_for_each name="$prop" valuename="$value" in="global.$kAAIT_Data.$byShipId.{'$' + player.target.idcode}.$attackData">
						<debug_text text="$prop + ': ' + $value" />
					</do_for_each>
				</do_if>
				<do_elseif value="event.param3.$text == 'debug aait bombers'">
					<debug_text text="player.target + ': ' + player.target.knownname + ', ' + player.target.idcode" />
					<debug_text text="player.target + ' missile.count: ' + player.target.ammostorage.missile.count" />
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait gun count'">
					<debug_text text="player.target + ': ' + @player.target.knownname + ', ' + @player.target.idcode" />
					<debug_text text="player.target + ' weapons.operational.count: ' + @player.target.weapons.operational.count" />
					<debug_text text="player.target + ' turrets.operational.count: ' + @player.target.turrets.operational.count" />
					<debug_text text="player.target + ' maxradarrange: ' + @player.target.maxradarrange" />
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait engage pos'">
					<set_value name="md.$target2" exact="@md.$target1" />
					<set_value name="md.$target1" exact="player.target" />
					<debug_text text="'$target1: ' + @md.$target1.idcode" />
					<debug_text text="'$target2: ' + @md.$target2.idcode" />
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait engage pos2'">
					<do_if value="@md.$target1 and @md.$target2">
						<set_value name="$attacker" exact="md.$target1" />
						<set_value name="$victim" exact="md.$target2" />
						<set_value name="$orderLocation_space" exact="$attacker.zone" />
						<create_position name="$posShip" space="$orderLocation_space" object="md.$target1" />
						<create_position name="$posTarget" space="$orderLocation_space" object="$victim" />
						<create_orientation name="$rotFromTarget" orientation="look_at" refposition="$posShip">
							<position value="$posTarget" />
						</create_orientation>
						<debug_text text="'$rotFromTarget: ' + $rotFromTarget" />
						<set_value name="$yaw_deg" exact="$rotFromTarget.yaw * 180 / pi" />
						<debug_text text="'$yaw_deg: ' + $yaw_deg" />
						<!-- <do_if value="$victim.isclass.ship or @$victim.defensible.isclass.ship">
							<set_value name="$yaw_deg" exact="$yaw_deg + [-30, -22, -15, -7, 0, 7, 15, 22, 30].random" />
						</do_if>
						<do_else>
							<set_value name="$yaw_deg" exact="$yaw_deg + [-45, -37, -30, -22, -15, -7, 0, 7, 15, 22, 30, 37, 45].random" />
						</do_else> -->
						<!-- <set_value name="$yaw_deg" exact="$yaw_deg - 45" /> -->
						<debug_text text="'$yaw_deg (adj): ' + $yaw_deg" />
						<set_value name="$yaw" exact="$yaw_deg * pi / 180" />
						<set_value name="$kAAIT_maxCombatRange" exact="8km" />
						<create_position name="$orderLocation_pos"
							x="$posTarget.x + $kAAIT_maxCombatRange * sin ($yaw) * cos ($rotFromTarget.pitch)"
							y="$posTarget.y + $kAAIT_maxCombatRange * sin ($rotFromTarget.pitch) + [-5m, -2.5m, 0, 2.5m, 5m].random"
							z="$posTarget.z + $kAAIT_maxCombatRange * cos ($yaw) * cos ($rotFromTarget.pitch)"
						/>
						<do_if value="@md.$beacon_debug">
							<destroy_object object="md.$beacon_debug" />
						</do_if>
						<create_object name="md.$beacon_debug"
							zone="$orderLocation_space"
							macro="macro.env_deco_nav_beacon_t1_macro"
							owner="faction.player">
							<position x="$orderLocation_pos.x" y="$orderLocation_pos.y" z="$orderLocation_pos.z" />
						</create_object>
					</do_if>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait ships'">
					<debug_text text="'global.$kAAIT_Data.$ships.count: ' + global.$kAAIT_Data.$ships.count" />
					<do_for_each name="$ship" in="global.$kAAIT_Data.$ships">
						<debug_text text="'isplayerowned: ' + $ship.isplayerowned + ' $ship: ' + $ship.knownname + ' ' + $ship.idcode" />
					</do_for_each>
				</do_elseif>
				<do_elseif value="event.param3.$text == 'debug aait eta'">
					<estimate_travel_time result="$kuertee_eta" start="player.ship" target="player.target" ship="player.ship" />
					<debug_text text="'$kuertee_eta: ' + $kuertee_eta" />
				</do_elseif>
				<reset_cue cue="this" />
			</actions>
		</cue>
	    <library name="CreateShip" purpose="run_actions">
	      <params>
	        <param name="MissionCue" default="null" />
	        <param name="Group" />
	        <param name="Owner" />
	        <param name="PilotFaction" />
	        <param name="ShipDefinition" />
	        <param name="Dock" default="null" />
	        <param name="Sector" default="null" />
	        <param name="Pos" default="null" />
	        <param name="Commander" default="null" />
	        <param name="Assignment" default="null" />
	        <param name="LoadoutLevel" default="null" />
	        <param name="PilotActor" default="null" />
	        <param name="DebugChance" default="0" />
	      </params>
	      <actions>
	        <set_value name="$Ship" exact="null" />
	        <set_value name="$IsValid" exact="true" />
	        <do_if value="(not $Dock) and (not $Sector) and (not $Pos)">
	          <set_value name="$IsValid" exact="false" />
	        </do_if>
	        <do_if value="$IsValid">
	          <do_if value="not $Assignment">
	            <set_value name="$Assignment" exact="assignment.attack" />
	          </do_if>
	          <do_if value="$Sector and $Pos">
	            <get_safe_pos result="$SafePos" sector="$Sector" value="$Pos" />
	            <do_if value="typeof $ShipDefinition == datatype.macro">
	              <create_ship name="$Ship" macro="$ShipDefinition" sector="$Sector">
	                <owner exact="$Owner" />
	                <loadout>
	                  <level exact="1" />
	                </loadout>
	                <position value="$SafePos" />
	              </create_ship>
	            </do_if>
	            <do_else>
	              <create_ship name="$Ship" ref="$ShipDefinition" sector="$Sector">
	                <owner exact="$Owner" />
	                <loadout>
	                  <level exact="1" />
	                </loadout>
	                <position value="$SafePos" />
	              </create_ship>
	            </do_else>
	          </do_if>
	          <do_elseif value="$Dock">
	            <do_if value="typeof $ShipDefinition == datatype.macro">
	              <create_ship name="$Ship" macro="$ShipDefinition" dock="$Dock">
	                <owner exact="$Owner" />
	                <loadout>
	                  <level exact="1" />
	                </loadout>
	              </create_ship>
	            </do_if>
	            <do_else>
	              <create_ship name="$Ship" ref="$ShipDefinition" dock="$Dock">
	                <owner exact="$Owner" />
	                <loadout>
	                  <level exact="1" />
	                </loadout>
	              </create_ship>
	            </do_else>
	          </do_elseif>
	          <do_else>
	            <set_value name="$IsValid" exact="false" />
	          </do_else>
	          <debug_text text="'$IsValid: ' + $IsValid" chance="$DebugChance" />
	          <do_if value="$IsValid">
	            <do_if value="$LoadoutLevel">
	              <generate_loadout result="$Loadout" faction="$PilotFaction" macro="$Ship.macro" level="$LoadoutLevel"/>
	            </do_if>
	            <do_else>
	              <generate_loadout result="$Loadout" faction="$PilotFaction" macro="$Ship.macro" level="$Ship.loadoutlevel"/>
	            </do_else>
	            <apply_loadout object="$Ship" loadout="$Loadout.{1}"/>
	            <debug_text text="'$Ship.owner: ' + $Ship.owner" chance="$DebugChance" />
	            <do_if value="not $PilotActor">
	              <create_control_entity object="$Ship" post="controlpost.aipilot">
	                <select faction="$PilotFaction"/>
	                <owner exact="$Owner" />
	              </create_control_entity>
	            </do_if>
	            <do_else>
	              <add_actor_to_room actor="$PilotActor" object="$Ship" />
	              <assign_control_entity object="$Ship" actor="$PilotActor" post="controlpost.aipilot" transfer="true"/>
	            </do_else>
	            <debug_text text="'$Ship.owner (post add pilot): ' + $Ship.owner" chance="$DebugChance" />
	            <start_script object="$Ship.pilot" name="'orders.base'" />
	            <do_if value="$Commander.exists">
	              <set_object_commander object="$Ship" commander="$Commander" assignment="$Assignment" />
	            </do_if>
	            <add_to_group groupname="$Group" object="$Ship" />
	            <debug_text text="'$Ship.pilot: ' + $Ship.pilot + ' ' + $Ship.pilot.knownname" chance="$DebugChance" />
	            <debug_text text="'$Ship: ' + $Ship + ' ' + $Ship.knownname" chance="$DebugChance" />
	            <debug_text text="'    $Ship.macro: ' + $Ship.macro" chance="$DebugChance" />
	            <do_for_each name="$Item" in="$Ship.loadout.wares.list">
	              <debug_text text="'    $Item: ' + $Item + ' ' + @$Item.id" chance="$DebugChance" />
	            </do_for_each>
	          </do_if>
	        </do_if>
	        <return value="$Ship" />
	      </actions>
	    </library>
	</cues>
</mdscript>
